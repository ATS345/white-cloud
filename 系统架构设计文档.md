# 游戏商店平台系统架构设计文档

## 1. 系统概述

本游戏商店平台是一个综合性的游戏分发平台，参考Steam平台的优秀实践，同时具有原创性与差异化。平台支持游戏的购买、下载、安装、评价等核心功能，同时为开发者提供完整的游戏管理、数据分析和收益管理功能。

## 2. 系统架构设计

### 2.1 架构风格

采用前后端分离的单服务架构，确保系统的易用性、可维护性和安全性。

### 2.2 架构分层

#### 2.2.1 前端层
- **用户界面层**：负责展示游戏分类、游戏详情、用户评价等内容
- **业务逻辑层**：处理用户交互、表单验证、状态管理等
- **数据访问层**：通过API与后端进行通信

#### 2.2.2 后端层
- **API层**：提供RESTful API，处理请求路由和认证授权
- **业务逻辑层**：处理核心业务逻辑，如用户管理、游戏管理、支付处理等
- **数据访问层**：负责与数据库交互

#### 2.2.3 数据层
- **SQLite数据库**：存储用户、游戏、订单等核心数据

## 3. 技术栈选择

### 3.1 前端技术栈
| 技术 | 用途 | 版本 |
| --- | --- | --- |
| React.js | 前端框架 | 18.x |
| Redux Toolkit | 状态管理 | 1.9.x |
| React Router | 路由管理 | 6.x |
| Axios | API请求 | 1.6.x |
| Socket.io | 实时通信 | 4.x |
| Material-UI | UI组件库 | 5.x |
| Formik + Yup | 表单处理 | 2.x + 1.x |
| Framer Motion | 动画效果 | 10.x |

### 3.2 后端技术栈
| 技术 | 用途 | 版本 |
| --- | --- | --- |
| Node.js | 后端运行环境 | 18.x |
| Express.js | Web框架 | 4.x |
| JWT | 身份验证 | 9.x |
| Sequelize | ORM框架 | 6.x |
| SQLite | 关系型数据库 | 5.x |
| Stripe | 支付处理 | - |

### 3.3 开发工具与流程
| 工具 | 用途 |
| --- | --- |
| Git | 版本控制 |
| Jest | 单元测试 |
| ESLint | 代码规范 |
| Vite | 构建工具 |

## 4. 数据库设计

### 4.1 核心表结构

#### 4.1.1 用户表（users）
| 字段名 | 数据类型 | 描述 |
| --- | --- | --- |
| id | INTEGER PRIMARY KEY AUTOINCREMENT | 主键 |
| username | VARCHAR(50) | 用户名 |
| email | VARCHAR(100) | 邮箱 |
| password_hash | VARCHAR(255) | 密码哈希 |
| avatar_url | VARCHAR(255) | 头像URL |
| created_at | DATETIME | 创建时间 |
| updated_at | DATETIME | 更新时间 |
| role | VARCHAR(20) | 角色：user, developer, admin |

#### 4.1.2 开发者表（developers）
| 字段名 | 数据类型 | 描述 |
| --- | --- | --- |
| id | INTEGER PRIMARY KEY AUTOINCREMENT | 主键 |
| company_name | VARCHAR(100) | 公司名称 |
| contact_email | VARCHAR(100) | 联系邮箱 |
| website | VARCHAR(255) | 官网 |
| bio | TEXT | 简介 |
| created_at | DATETIME | 创建时间 |
| updated_at | DATETIME | 更新时间 |

#### 4.1.3 游戏表（games）
| 字段名 | 数据类型 | 描述 |
| --- | --- | --- |
| id | INTEGER PRIMARY KEY AUTOINCREMENT | 主键 |
| developer_id | INTEGER | 外键，关联developers表 |
| title | VARCHAR(100) | 游戏标题 |
| description | TEXT | 游戏描述 |
| price | DECIMAL(10,2) | 价格 |
| discount_price | DECIMAL(10,2) | 折扣价格 |
| release_date | DATETIME | 发布日期 |
| rating | DECIMAL(3,2) | 评分 |
| review_count | INTEGER | 评论数量 |
| status | TEXT | 状态：pending, approved, rejected |
| main_image_url | VARCHAR(255) | 主图URL |
| cover_image | VARCHAR(255) | 封面图URL |
| executable_path | VARCHAR(255) | 可执行文件路径 |
| launch_parameters | VARCHAR(255) | 启动参数 |
| latest_version | VARCHAR(20) | 最新版本 |
| download_url | VARCHAR(255) | 下载URL |
| created_at | DATETIME | 创建时间 |
| updated_at | DATETIME | 更新时间 |

#### 4.1.4 游戏分类表（game_categories）
| 字段名 | 数据类型 | 描述 |
| --- | --- | --- |
| id | INTEGER PRIMARY KEY AUTOINCREMENT | 主键 |
| name | VARCHAR(50) | 分类名称 |
| description | TEXT | 分类描述 |

#### 4.1.5 游戏标签表（game_tags）
| 字段名 | 数据类型 | 描述 |
| --- | --- | --- |
| id | INTEGER PRIMARY KEY AUTOINCREMENT | 主键 |
| name | VARCHAR(50) | 标签名称 |

#### 4.1.6 游戏版本表（game_versions）
| 字段名 | 数据类型 | 描述 |
| --- | --- | --- |
| id | INTEGER PRIMARY KEY AUTOINCREMENT | 主键 |
| game_id | INTEGER | 外键，关联games表 |
| version_number | VARCHAR(20) | 版本号 |
| release_date | DATETIME | 发布日期 |
| changelog | TEXT | 更新日志 |
| file_url | VARCHAR(255) | 文件URL |
| file_size | BIGINT | 文件大小 |
| platform | TEXT | 平台：windows, mac, linux |
| created_at | DATETIME | 创建时间 |
| updated_at | DATETIME | 更新时间 |

#### 4.1.7 游戏系统需求表（game_system_requirements）
| 字段名 | 数据类型 | 描述 |
| --- | --- | --- |
| id | INTEGER PRIMARY KEY AUTOINCREMENT | 主键 |
| game_id | INTEGER | 外键，关联games表 |
| os | VARCHAR(100) | 操作系统 |
| processor | VARCHAR(100) | 处理器 |
| memory | VARCHAR(50) | 内存 |
| graphics | VARCHAR(100) | 显卡 |
| storage | VARCHAR(50) | 存储 |
| type | TEXT | 类型：minimum, recommended |

#### 4.1.8 订单表（orders）
| 字段名 | 数据类型 | 描述 |
| --- | --- | --- |
| id | INTEGER PRIMARY KEY AUTOINCREMENT | 主键 |
| user_id | INTEGER | 外键，关联users表 |
| total_amount | DECIMAL(10,2) | 总金额 |
| status | TEXT | 状态：pending, paid, failed, refunded |
| payment_method | VARCHAR(50) | 支付方式 |
| transaction_id | VARCHAR(100) | 交易ID |
| created_at | DATETIME | 创建时间 |
| updated_at | DATETIME | 更新时间 |

#### 4.1.9 订单商品表（order_items）
| 字段名 | 数据类型 | 描述 |
| --- | --- | --- |
| id | INTEGER PRIMARY KEY AUTOINCREMENT | 主键 |
| order_id | INTEGER | 外键，关联orders表 |
| game_id | INTEGER | 外键，关联games表 |
| price | DECIMAL(10,2) | 购买价格 |
| quantity | INTEGER | 购买数量 |

#### 4.1.10 游戏库表（game_library）
| 字段名 | 数据类型 | 描述 |
| --- | --- | --- |
| id | INTEGER PRIMARY KEY AUTOINCREMENT | 主键 |
| user_id | INTEGER | 外键，关联users表 |
| game_id | INTEGER | 外键，关联games表 |
| purchase_date | DATETIME | 购买日期 |
| last_played_at | DATETIME | 最后游玩时间 |
| playtime | INTEGER | 游玩时间（分钟） |
| installed | BOOLEAN | 是否已安装 |
| needs_update | BOOLEAN | 是否需要更新 |
| installation_status | TEXT | 安装状态：pending, downloading, installing, completed, failed |
| installation_id | VARCHAR(50) | 安装任务ID |
| installed_version | VARCHAR(20) | 已安装版本 |
| last_updated_at | DATETIME | 最后更新时间 |

#### 4.1.11 评价表（reviews）
| 字段名 | 数据类型 | 描述 |
| --- | --- | --- |
| id | INTEGER PRIMARY KEY AUTOINCREMENT | 主键 |
| user_id | INTEGER | 外键，关联users表 |
| game_id | INTEGER | 外键，关联games表 |
| rating | INTEGER | 评分（1-5） |
| content | TEXT | 评价内容 |
| created_at | DATETIME | 创建时间 |
| updated_at | DATETIME | 更新时间 |

#### 4.1.12 评价回复表（review_replies）
| 字段名 | 数据类型 | 描述 |
| --- | --- | --- |
| id | INTEGER PRIMARY KEY AUTOINCREMENT | 主键 |
| user_id | INTEGER | 外键，关联users表 |
| review_id | INTEGER | 外键，关联reviews表 |
| content | TEXT | 回复内容 |
| created_at | DATETIME | 创建时间 |
| updated_at | DATETIME | 更新时间 |

#### 4.1.13 开发者财务表（developer_finances）
| 字段名 | 数据类型 | 描述 |
| --- | --- | --- |
| id | INTEGER PRIMARY KEY AUTOINCREMENT | 主键 |
| developer_id | INTEGER | 外键，关联developers表 |
| period_start | DATETIME | 财务周期开始日期 |
| period_end | DATETIME | 财务周期结束日期 |
| total_sales | DECIMAL(15,2) | 总销售额 |
| platform_fee | DECIMAL(15,2) | 平台分成 |
| developer_earnings | DECIMAL(15,2) | 开发者收益 |
| status | TEXT | 财务状态：pending, processed, paid |
| created_at | DATETIME | 创建时间 |
| updated_at | DATETIME | 更新时间 |

#### 4.1.14 提现请求表（withdrawal_requests）
| 字段名 | 数据类型 | 描述 |
| --- | --- | --- |
| id | INTEGER PRIMARY KEY AUTOINCREMENT | 主键 |
| developer_id | INTEGER | 外键，关联developers表 |
| amount | DECIMAL(15,2) | 提现金额 |
| payment_method | VARCHAR(50) | 提现方式 |
| payment_account | VARCHAR(100) | 支付账号 |
| status | TEXT | 提现状态：pending, approved, rejected, processed |
| admin_note | TEXT | 审核备注 |
| processed_at | DATETIME | 处理日期 |
| created_at | DATETIME | 创建时间 |
| updated_at | DATETIME | 更新时间 |

## 5. API设计

### 5.1 认证API

| 端点 | 方法 | 功能 | 认证 |
| --- | --- | --- | --- |
| /api/v1/auth/register | POST | 用户注册 | 否 |
| /api/v1/auth/login | POST | 用户登录 | 否 |
| /api/v1/auth/logout | POST | 用户登出 | 是 |
| /api/v1/auth/me | GET | 获取当前用户信息 | 是 |

### 5.2 游戏API

| 端点 | 方法 | 功能 | 认证 |
| --- | --- | --- | --- |
| /api/v1/games | GET | 获取游戏列表 | 否 |
| /api/v1/games/:id | GET | 获取游戏详情 | 否 |
| /api/v1/games/:id/launch | POST | 启动游戏 | 是 |
| /api/v1/games/:id/install | POST | 安装游戏 | 是 |
| /api/v1/games/:id/update | POST | 更新游戏 | 是 |
| /api/v1/games/:id/sync | POST | 同步游戏数据 | 是 |

### 5.3 开发者API

| 端点 | 方法 | 功能 | 认证 |
| --- | --- | --- | --- |
| /api/v1/developer/games | GET | 获取开发者游戏列表 | 是（开发者） |
| /api/v1/developer/games | POST | 创建新游戏 | 是（开发者） |
| /api/v1/developer/games/:id | PUT | 更新游戏信息 | 是（开发者） |
| /api/v1/developer/games/:id/versions | POST | 发布游戏版本 | 是（开发者） |
| /api/v1/developer/analytics | GET | 获取游戏分析数据 | 是（开发者） |
| /api/v1/developer/finances | GET | 获取财务报表 | 是（开发者） |
| /api/v1/developer/withdrawals | POST | 提交提现请求 | 是（开发者） |

## 6. 部署指南

### 6.1 环境要求

| 环境 | 要求 |
| --- | --- |
| Node.js | 18.x或更高版本 |
| npm | 8.x或更高版本 |
| SQLite | 5.x或更高版本 |

### 6.2 部署步骤

1. 克隆代码仓库
2. 安装依赖：`npm install`
3. 配置环境变量
4. 运行数据库迁移：`npm run migrate`
5. 启动后端服务：`npm start`
6. 构建前端项目：`npm run build`
7. 启动前端服务：`npm run preview`

### 6.3 环境变量配置

| 变量名 | 描述 | 默认值 |
| --- | --- | --- |
| PORT | 后端服务端口 | 5000 |
| NODE_ENV | 运行环境 | development |
| JWT_SECRET | JWT密钥 | - |
| JWT_EXPIRES_IN | JWT过期时间 | 7d |
| CORS_ORIGIN | 允许的CORS来源 | http://localhost:3000 |
| DB_DIALECT | 数据库方言 | sqlite |

## 7. 监控与日志

### 7.1 监控指标

| 指标 | 描述 |
| --- | --- |
| API响应时间 | 测量API请求的响应时间 |
| 错误率 | 跟踪API错误的发生率 |
| 服务器资源使用率 | CPU、内存、磁盘使用率 |
| 用户活跃度 | 跟踪用户登录、游戏购买等活动 |

### 7.2 日志记录

| 日志类型 | 描述 |
| --- | --- |
| 访问日志 | 记录所有API请求和响应 |
| 错误日志 | 记录系统错误和异常 |
| 业务日志 | 记录关键业务操作，如游戏购买、提现请求等 |

## 8. 维护与迭代计划

### 8.1 维护任务

| 任务 | 频率 |
| --- | --- |
| 数据库备份 | 每日 |
| 日志清理 | 每周 |
| 依赖更新 | 每月 |
| 安全扫描 | 每月 |

### 8.2 迭代计划

| 版本 | 功能 | 计划时间 |
| --- | --- | --- |
| 1.1 | 添加游戏成就系统 | 2026年1月 |
| 1.2 | 添加多人游戏支持 | 2026年2月 |
| 1.3 | 添加游戏直播功能 | 2026年3月 |
| 1.4 | 添加VR游戏支持 | 2026年4月 |
