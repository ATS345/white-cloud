# 游戏商店平台系统架构设计文档

## 1. 系统概述

本游戏商店平台是一个综合性的游戏分发平台，参考Steam平台的优秀实践，同时具有原创性与差异化。平台支持游戏的购买、下载、安装、评价等核心功能，同时为开发者提供完整的游戏管理、数据分析和收益管理功能。

## 2. 系统架构设计

### 2.1 架构风格

采用前后端分离的微服务架构，确保系统的高可用性、可扩展性和安全性。

### 2.2 架构分层

#### 2.2.1 前端层
- **用户界面层**：负责展示游戏分类、游戏详情、用户评价等内容
- **业务逻辑层**：处理用户交互、表单验证、状态管理等
- **数据访问层**：通过API与后端进行通信

#### 2.2.2 后端层
- **API网关**：统一入口，处理请求路由、负载均衡、认证授权等
- **业务服务层**：包含多个微服务，如用户服务、游戏服务、支付服务等
- **数据访问层**：负责与数据库交互
- **基础设施层**：提供缓存、消息队列、文件存储等基础服务

#### 2.2.3 数据层
- **关系型数据库**：存储用户、游戏、订单等核心数据
- **非关系型数据库**：存储游戏截图、视频、用户评价等非结构化数据
- **缓存数据库**：存储热点数据、会话信息等
- **搜索引擎**：支持游戏搜索、用户搜索等

## 3. 技术栈选择

### 3.1 前端技术栈
| 技术 | 用途 | 版本 |
| --- | --- | --- |
| React.js | 前端框架 | 18.x |
| Redux Toolkit | 状态管理 | 1.9.x |
| React Router | 路由管理 | 6.x |
| Axios | API请求 | 1.6.x |
| Socket.io | 实时通信 | 4.x |
| Material-UI | UI组件库 | 5.x |
| Styled Components | 样式管理 | 6.x |
| Formik + Yup | 表单处理 | 2.x + 1.x |
| Framer Motion | 动画效果 | 10.x |

### 3.2 后端技术栈
| 技术 | 用途 | 版本 |
| --- | --- | --- |
| Node.js | 后端运行环境 | 18.x |
| Express.js | Web框架 | 4.x |
| Passport.js | 认证中间件 | 0.6.x |
| JWT | 身份验证 | 9.x |
| Sequelize | ORM框架 | 6.x |
| PostgreSQL | 关系型数据库 | 15.x |
| MongoDB | 非关系型数据库 | 6.x |
| Redis | 缓存数据库 | 7.x |
| RabbitMQ | 消息队列 | 3.12.x |
| AWS S3 | 文件存储 | - |
| AWS CloudFront | CDN加速 | - |
| Stripe | 支付处理 | - |

### 3.3 开发工具与流程
| 工具 | 用途 |
| --- | --- |
| Git + GitHub | 版本控制 |
| GitHub Actions | CI/CD |
| Jest | 单元测试 |
| Cypress | 端到端测试 |
| ESLint + Prettier | 代码规范 |
| Swagger | API文档 |
| Storybook | 组件文档 |

## 4. 数据库设计

### 4.1 核心表结构

#### 4.1.1 用户表（users）
| 字段名 | 数据类型 | 描述 |
| --- | --- | --- |
| id | SERIAL | 主键 |
| username | VARCHAR(50) | 用户名 |
| email | VARCHAR(100) | 邮箱 |
| password_hash | VARCHAR(255) | 密码哈希 |
| avatar_url | VARCHAR(255) | 头像URL |
| created_at | TIMESTAMP | 创建时间 |
| updated_at | TIMESTAMP | 更新时间 |
| role | VARCHAR(20) | 角色：user, developer, admin |

#### 4.1.2 开发者表（developers）
| 字段名 | 数据类型 | 描述 |
| --- | --- | --- |
| id | SERIAL | 主键 |
| user_id | INTEGER | 外键，关联users表 |
| company_name | VARCHAR(100) | 公司名称 |
| contact_email | VARCHAR(100) | 联系邮箱 |
| website | VARCHAR(255) | 官网 |
| bio | TEXT | 简介 |
| created_at | TIMESTAMP | 创建时间 |
| updated_at | TIMESTAMP | 更新时间 |

#### 4.1.3 游戏表（games）
| 字段名 | 数据类型 | 描述 |
| --- | --- | --- |
| id | SERIAL | 主键 |
| developer_id | INTEGER | 外键，关联developers表 |
| title | VARCHAR(100) | 游戏标题 |
| description | TEXT | 游戏描述 |
| price | DECIMAL(10,2) | 价格 |
| discount_price | DECIMAL(10,2) | 折扣价格 |
| release_date | DATE | 发布日期 |
| rating | DECIMAL(3,2) | 评分 |
| review_count | INTEGER | 评论数量 |
| status | VARCHAR(20) | 状态：pending, approved, rejected |
| created_at | TIMESTAMP | 创建时间 |
| updated_at | TIMESTAMP | 更新时间 |

#### 4.1.4 游戏分类表（game_categories）
| 字段名 | 数据类型 | 描述 |
| --- | --- | --- |
| id | SERIAL | 主键 |
| name | VARCHAR(50) | 分类名称 |
| description | TEXT | 分类描述 |

#### 4.1.5 游戏-分类关联表（game_category_relations）
| 字段名 | 数据类型 | 描述 |
| --- | --- | --- |
| game_id | INTEGER | 外键，关联games表 |
| category_id | INTEGER | 外键，关联game_categories表 |

#### 4.1.6 游戏标签表（game_tags）
| 字段名 | 数据类型 | 描述 |
| --- | --- | --- |
| id | SERIAL | 主键 |
| name | VARCHAR(50) | 标签名称 |

#### 4.1.7 游戏-标签关联表（game_tag_relations）
| 字段名 | 数据类型 | 描述 |
| --- | --- | --- |
| game_id | INTEGER | 外键，关联games表 |
| tag_id | INTEGER | 外键，关联game_tags表 |

#### 4.1.8 游戏版本表（game_versions）
| 字段名 | 数据类型 | 描述 |
| --- | --- | --- |
| id | SERIAL | 主键 |
| game_id | INTEGER | 外键，关联games表 |
| version_number | VARCHAR(20) | 版本号 |
| release_date | DATE | 发布日期 |
| changelog | TEXT | 更新日志 |
| file_url | VARCHAR(255) | 文件URL |
| file_size | BIGINT | 文件大小 |
| platform | VARCHAR(20) | 平台：windows, mac, linux |

#### 4.1.9 游戏系统需求表（game_system_requirements）
| 字段名 | 数据类型 | 描述 |
| --- | --- | --- |
| id | SERIAL | 主键 |
| game_id | INTEGER | 外键，关联games表 |
| os | VARCHAR(100) | 操作系统 |
| processor | VARCHAR(100) | 处理器 |
| memory | VARCHAR(50) | 内存 |
| graphics | VARCHAR(100) | 显卡 |
| storage | VARCHAR(50) | 存储 |
| type | VARCHAR(20) | 类型：minimum, recommended |

#### 4.1.10 订单表（orders）
| 字段名 | 数据类型 | 描述 |
| --- | --- | --- |
| id | SERIAL | 主键 |
| user_id | INTEGER | 外键，关联users表 |
| total_amount | DECIMAL(10,2) | 总金额 |
| status | VARCHAR(20) | 状态：pending, paid, failed, refunded |
| payment_method | VARCHAR(50) | 支付方式 |
| transaction_id | VARCHAR(100) | 交易ID |
| created_at | TIMESTAMP | 创建时间 |
| updated_at | TIMESTAMP | 更新时间 |

#### 4.1.11 订单商品表（order_items）
| 字段名 | 数据类型 | 描述 |
| --- | --- | --- |
| id | SERIAL | 主键 |
| order_id | INTEGER | 外键，关联orders表 |
| game_id | INTEGER | 外键，关联games表 |
| price | DECIMAL(10,2) | 购买价格 |
| quantity | INTEGER | 数量 |

#### 4.1.12 游戏库表（game_library）
| 字段名 | 数据类型 | 描述 |
| --- | --- | --- |
| id | SERIAL | 主键 |
| user_id | INTEGER | 外键，关联users表 |
| game_id | INTEGER | 外键，关联games表 |
| purchase_date | TIMESTAMP | 购买日期 |
| last_played_at | TIMESTAMP | 最后游玩时间 |
| playtime | INTEGER | 游玩时间，单位：分钟 |

#### 4.1.13 评价表（reviews）
| 字段名 | 数据类型 | 描述 |
| --- | --- | --- |
| id | SERIAL | 主键 |
| user_id | INTEGER | 外键，关联users表 |
| game_id | INTEGER | 外键，关联games表 |
| rating | INTEGER | 评分：1-5 |
| content | TEXT | 评价内容 |
| created_at | TIMESTAMP | 创建时间 |
| updated_at | TIMESTAMP | 更新时间 |

#### 4.1.14 评论回复表（review_replies）
| 字段名 | 数据类型 | 描述 |
| --- | --- | --- |
| id | SERIAL | 主键 |
| review_id | INTEGER | 外键，关联reviews表 |
| user_id | INTEGER | 外键，关联users表 |
| content | TEXT | 回复内容 |
| created_at | TIMESTAMP | 创建时间 |

#### 4.1.15 开发者财务表（developer_finances）
| 字段名 | 数据类型 | 描述 |
| --- | --- | --- |
| id | SERIAL | 主键 |
| developer_id | INTEGER | 外键，关联developers表 |
| month | INTEGER | 月份 |
| year | INTEGER | 年份 |
| total_sales | DECIMAL(10,2) | 总销售额 |
| platform_fee | DECIMAL(10,2) | 平台费用 |
| net_income | DECIMAL(10,2) | 净收入 |
| status | VARCHAR(20) | 状态：pending, processed, paid |

#### 4.1.16 提现申请表（withdrawal_requests）
| 字段名 | 数据类型 | 描述 |
| --- | --- | --- |
| id | SERIAL | 主键 |
| developer_id | INTEGER | 外键，关联developers表 |
| amount | DECIMAL(10,2) | 提现金额 |
| payment_method | VARCHAR(50) | 支付方式 |
| status | VARCHAR(20) | 状态：pending, approved, rejected, processed |
| created_at | TIMESTAMP | 创建时间 |
| updated_at | TIMESTAMP | 更新时间 |

## 5. API接口规范

### 5.1 接口设计原则
- 采用RESTful API设计风格
- 使用JSON格式进行数据交换
- 统一的错误处理机制
- 完善的认证与授权机制
- 支持版本控制

### 5.2 核心API接口

#### 5.2.1 用户认证与授权
| 方法 | 路径 | 描述 | 权限 |
| --- | --- | --- | --- |
| POST | /api/v1/auth/register | 用户注册 | 无 |
| POST | /api/v1/auth/login | 用户登录 | 无 |
| POST | /api/v1/auth/logout | 用户登出 | 用户 |
| GET | /api/v1/auth/me | 获取当前用户信息 | 用户 |
| PUT | /api/v1/auth/password | 修改密码 | 用户 |

#### 5.2.2 游戏管理
| 方法 | 路径 | 描述 | 权限 |
| --- | --- | --- | --- |
| GET | /api/v1/games | 获取游戏列表（支持筛选、排序、分页） | 无 |
| GET | /api/v1/games/:id | 获取游戏详情 | 无 |
| POST | /api/v1/games | 上传新游戏 | 开发者 |
| PUT | /api/v1/games/:id | 更新游戏信息 | 开发者 |
| DELETE | /api/v1/games/:id | 删除游戏 | 开发者 |
| GET | /api/v1/games/:id/screenshots | 获取游戏截图 | 无 |
| POST | /api/v1/games/:id/screenshots | 上传游戏截图 | 开发者 |
| GET | /api/v1/games/:id/videos | 获取游戏视频 | 无 |
| POST | /api/v1/games/:id/videos | 上传游戏视频 | 开发者 |

#### 5.2.3 游戏版本管理
| 方法 | 路径 | 描述 | 权限 |
| --- | --- | --- | --- |
| GET | /api/v1/games/:id/versions | 获取游戏版本列表 | 无 |
| POST | /api/v1/games/:id/versions | 上传游戏新版本 | 开发者 |
| GET | /api/v1/games/:id/versions/:version_id | 获取游戏版本详情 | 无 |
| PUT | /api/v1/games/:id/versions/:version_id | 更新游戏版本信息 | 开发者 |

#### 5.2.4 游戏库管理
| 方法 | 路径 | 描述 | 权限 |
| --- | --- | --- | --- |
| GET | /api/v1/user/library | 获取用户游戏库 | 用户 |
| POST | /api/v1/user/library/:game_id | 添加游戏到库（购买后） | 用户 |
| DELETE | /api/v1/user/library/:game_id | 从库中移除游戏 | 用户 |
| PUT | /api/v1/user/library/:game_id/playtime | 更新游戏游玩时间 | 用户 |

#### 5.2.5 评价与评分系统
| 方法 | 路径 | 描述 | 权限 |
| --- | --- | --- | --- |
| GET | /api/v1/games/:id/reviews | 获取游戏评价列表 | 无 |
| POST | /api/v1/games/:id/reviews | 提交游戏评价 | 用户 |
| PUT | /api/v1/reviews/:id | 更新游戏评价 | 用户 |
| DELETE | /api/v1/reviews/:id | 删除游戏评价 | 用户 |
| POST | /api/v1/reviews/:id/replies | 回复游戏评价 | 用户/开发者 |

#### 5.2.6 支付系统
| 方法 | 路径 | 描述 | 权限 |
| --- | --- | --- | --- |
| POST | /api/v1/payments/intent | 创建支付意图 | 用户 |
| GET | /api/v1/payments/:id | 获取支付详情 | 用户 |
| POST | /api/v1/payments/:id/confirm | 确认支付 | 用户 |

#### 5.2.7 游戏下载
| 方法 | 路径 | 描述 | 权限 |
| --- | --- | --- | --- |
| GET | /api/v1/games/:id/download | 获取游戏下载链接 | 用户 |
| GET | /api/v1/games/:id/versions/:version_id/download | 获取特定版本下载链接 | 用户 |

#### 5.2.8 开发者后台
| 方法 | 路径 | 描述 | 权限 |
| --- | --- | --- | --- |
| GET | /api/v1/developer/games | 获取开发者游戏列表 | 开发者 |
| GET | /api/v1/developer/sales | 获取销售数据统计 | 开发者 |
| GET | /api/v1/developer/finances | 获取财务报表 | 开发者 |
| POST | /api/v1/developer/withdrawal | 提交提现申请 | 开发者 |
| GET | /api/v1/developer/withdrawal | 获取提现记录 | 开发者 |

## 6. 系统安全设计

### 6.1 认证与授权
- 使用JWT进行身份验证
- 基于角色的访问控制（RBAC）
- 密码加密存储

### 6.2 数据安全
- HTTPS加密传输
- SQL注入防护
- XSS防护
- CSRF防护
- 敏感数据脱敏

### 6.3 系统安全
- API接口限流
- 定期安全审计
- 系统监控与告警
- 数据备份与恢复

## 7. 系统监控与日志

### 7.1 日志管理
- 使用ELK Stack（Elasticsearch、Logstash、Kibana）进行日志管理和分析
- 记录系统日志、应用日志、访问日志等

### 7.2 系统监控
- 使用Prometheus + Grafana进行系统监控和告警
- 监控CPU、内存、磁盘、网络等系统指标
- 监控API响应时间、错误率等应用指标

### 7.3 分布式追踪
- 使用Jaeger或Zipkin进行分布式追踪
- 追踪请求在各个微服务之间的流转

## 8. 部署架构

### 8.1 容器化部署
- 使用Docker进行容器化部署
- 使用Kubernetes进行容器编排

### 8.2 高可用性设计
- 多可用区部署
- 自动扩容与缩容
- 负载均衡

### 8.3 CI/CD流程
- 自动化构建、测试、部署
- 灰度发布和A/B测试

## 9. 未来扩展性

### 9.1 功能扩展
- 支持VR/AR游戏
- 支持云游戏
- 支持游戏直播
- 支持游戏赛事

### 9.2 技术扩展
- 支持更多平台（移动端、主机端）
- 支持更多支付方式
- 支持更多语言和地区
- 支持机器学习和AI功能

## 10. 文档版本

| 版本 | 日期 | 作者 | 描述 |
| --- | --- | --- | --- |
| 1.0 | 2025-12-03 | AI助手 | 初始版本 |
